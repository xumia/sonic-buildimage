# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool: sonic-mirror-build
  #vmImage: 'ubuntu-latest'

steps:
- script: echo Hello, world!
  displayName: 'Run a one-line script'

- bash: |
    if [ -z "$(which gh)" ]; then
      sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-key C99B11DEB97541F0
      sudo apt-add-repository https://cli.github.com/packages
       sudo apt update
      sudo apt install gh
    fi
  displayName: 'Install gh'
- bash: |
    [ -d sonic-buildimage-2 ] && rm -rf sonic-buildimage-2
    git clone -b repd https://github.com/xumia/sonic-buildimage-2
    cd sonic-buildimage-2
    git remote add azure https://github.com/Azure/sonic-buildimage
    git branch -vv
    git config user.name $GIT_USER
    git config credential.https://github.com.username $GIT_USER
    export GIT_ASKPASS=../git_env_password.sh
    git checkout repd
    git pull --all
    echo "git merge azure/master"
    git merge azure/master
    git push
  env:
    GIT_USER: $(GIT_USER)
    GIT_PASSWORD: $(GIT_PASSWORD)
  displayName: 'Merge azure/sonic-buildimage master branch'

- script: |
    echo Add other tasks to build, test, and deploy your project.
    echo See https://aka.ms/yaml
  displayName: 'Run a multi-line script'
